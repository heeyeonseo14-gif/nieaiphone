<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NIEaiphone â€” å°å®¶ï¼ˆå¯å®šåˆ¶ï¼‰</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#f0e6fb; --bg2:#e6d8f6; --card:rgba(255,255,255,0.36);
      --accent1:#9b86e6; --accent2:#7a64d0; --text:#2f2540;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:"Quicksand","Nunito","Segoe UI",sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;color:var(--text);
      padding:20px;
    }

    /* æ‰‹æœºæ¡†æ¶ */
    .frame{
      width:92%;max-width:420px;height:84vh;border-radius:34px;background:var(--card);
      backdrop-filter:blur(14px);box-shadow:0 18px 50px rgba(40,24,60,0.12);padding:18px;display:flex;flex-direction:column;position:relative;
    }

    .top{display:flex;align-items:center;gap:12px;padding:8px 6px}
    .logoBox{
      width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg,#fff,#fff8);box-shadow:0 8px 22px rgba(124,93,232,0.12);overflow:hidden;
      flex-shrink:0;
    }
    .logoBox img{width:100%;height:100%;object-fit:cover;display:block}
    .titleWrap{flex:1}
    .title{font-size:20px;font-weight:700;margin:0}
    .subtitle{font-size:12px;color:rgba(47,37,64,0.7);margin-top:4px}

    .controlsRow{display:flex;gap:8px;align-items:center;margin-left:8px}
    .editBtn{background:transparent;border:1px solid rgba(47,37,64,0.06);padding:8px 10px;border-radius:10px;font-size:13px;cursor:pointer}

    /* å›¾æ ‡ç½‘æ ¼ï¼šæ¯ä¸ªå›¾æ ‡åªæ˜¾ç¤ºå›¾ç‰‡ï¼ˆæ­£æ–¹å½¢ï¼‰ï¼Œæ— ç™½è‰²èƒŒæ™¯ */
    .screen{flex:1;display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;padding:8px 6px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:8px}
    .icon{
      display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;user-select:none;
      transition:transform .14s ease, box-shadow .14s ease; padding:6px; border-radius:14px; text-align:center;
    }
    .icon:hover{transform:translateY(-6px)}
    .iconImg{
      width:72px;height:72px;border-radius:14px;overflow:hidden;display:flex;align-items:center;justify-content:center;
      box-shadow: 0 8px 22px rgba(47,35,70,0.06); background:transparent;
    }
    .iconImg img{width:100%;height:100%;object-fit:cover;display:block}
    .iconLabel{font-size:13px;font-weight:600;color:#3b2f4b}

    /* footer */
    .footer{font-size:12px;color:rgba(47,37,64,0.6);text-align:center;padding:8px;margin-top:8px}

    /* è‡ªå®šä¹‰é¢æ¿ï¼ˆmodalï¼‰ */
    .modalWrap{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(8,6,12,0.45);z-index:1000}
    .modal{width:92%;max-width:560px;background:white;border-radius:14px;padding:18px;box-shadow:0 30px 80px rgba(12,10,25,0.5)}
    .modal h3{margin:0 0 12px;font-size:18px}
    .field{margin-bottom:12px}
    .field label{display:block;font-size:13px;margin-bottom:6px;color:#3b2f4b}
    .field input[type="text"], .field input[type="url"], .field textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(15,12,20,0.06)}
    .rowInputs{display:flex;gap:8px}
    .small{font-size:12px;color:#6b5f7a;margin-top:6px}
    .modalActions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .btnPrimary{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:white;padding:8px 14px;border-radius:10px;border:none;cursor:pointer}
    .btnGhost{background:transparent;border:1px solid rgba(47,37,64,0.06);padding:8px 12px;border-radius:10px;cursor:pointer}

    /* responsiveness */
    @media (max-width:360px){
      .iconImg{width:60px;height:60px}
    }
  </style>
</head>
<body>
  <div class="frame" role="application" aria-label="NIEaiphone å°å®¶ï¼ˆå¯å®šåˆ¶ï¼‰">
    <div class="top">
      <div class="logoBox" id="logoBox" title="ç‚¹å‡»æ›´æ¢logo">
        <!-- logo img æˆ– emoji -->
        <img id="logoImg" alt="logo" src="">
      </div>

      <div class="titleWrap">
        <div class="title" id="pageTitle">NIEaiphone</div>
        <div class="subtitle" id="pageSubtitle">æ¬¢è¿å›å®¶ Â· ç‚¹å‡»å›¾æ ‡æ‰“å¼€åº”ç”¨</div>
      </div>

      <div class="controlsRow">
        <button class="editBtn" id="openCustomize">è‡ªå®šä¹‰</button>
      </div>
    </div>

    <div class="screen">
      <div class="grid" role="grid" id="iconGrid">
        <!-- icons: each has data-key to identify -->
        <div class="icon" data-key="chat" tabindex="0" role="button" aria-label="èŠå¤©">
          <div class="iconImg"><img id="icon-chat" src="" alt="èŠå¤©"></div>
          <div class="iconLabel">èŠå¤©</div>
        </div>

        <div class="icon" data-key="diary" tabindex="0" role="button" aria-label="æ—¥è®°">
          <div class="iconImg"><img id="icon-diary" src="" alt="æ—¥è®°"></div>
          <div class="iconLabel">æ—¥è®°</div>
        </div>

        <div class="icon" data-key="forum" tabindex="0" role="button" aria-label="è®ºå›">
          <div class="iconImg"><img id="icon-forum" src="" alt="è®ºå›"></div>
          <div class="iconLabel">è®ºå›</div>
        </div>

        <div class="icon" data-key="api" tabindex="0" role="button" aria-label="API è®¾ç½®">
          <div class="iconImg"><img id="icon-api" src="" alt="API"></div>
          <div class="iconLabel">API è®¾ç½®</div>
        </div>

        <div class="icon" data-key="theme" tabindex="0" role="button" aria-label="ç¾åŒ–">
          <div class="iconImg"><img id="icon-theme" src="" alt="ç¾åŒ–"></div>
          <div class="iconLabel">ç¾åŒ–</div>
        </div>

        <div class="icon" data-key="more" tabindex="0" role="button" aria-label="æ›´å¤š">
          <div class="iconImg"><img id="icon-more" src="" alt="æ›´å¤š"></div>
          <div class="iconLabel">æ›´å¤š</div>
        </div>
      </div>

      <div style="flex:1"></div>
    </div>

    <div class="footer">* æç¤ºï¼šç‚¹å‡»â€œè‡ªå®šä¹‰â€å¯ä»¥æ›´æ¢æ ‡é¢˜ / å‰¯æ ‡é¢˜ / logo / æ¯ä¸ªå›¾æ ‡çš„å›¾ç‰‡ï¼ˆæ”¯æŒä¸Šä¼ æˆ–å¡« URLï¼‰ã€‚</div>
  </div>

  <!-- è‡ªå®šä¹‰æ¨¡æ€ -->
  <div class="modalWrap" id="modalWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="customTitle">
      <h3 id="customTitle">è‡ªå®šä¹‰ä¸»é¡µ</h3>

      <div class="field">
        <label>ä¸»é¡µæ ‡é¢˜ï¼ˆç¤ºä¾‹ï¼šNIEaiphoneï¼‰</label>
        <input type="text" id="inputTitle" placeholder="è¾“å…¥ä¸»é¡µæ ‡é¢˜">
      </div>

      <div class="field">
        <label>å‰¯æ ‡é¢˜ï¼ˆç¤ºä¾‹ï¼šæ¬¢è¿å›å®¶ Â· ç‚¹å‡»å›¾æ ‡æ‰“å¼€åº”ç”¨ï¼‰</label>
        <input type="text" id="inputSubtitle" placeholder="è¾“å…¥å‰¯æ ‡é¢˜">
      </div>

      <div class="field">
        <label>Logoï¼ˆå¿ƒå½¢ï¼‰â€” å¯ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ æˆ– ç²˜è´´å›¾ç‰‡ URL</label>
        <div class="rowInputs">
          <input type="file" id="logoFile" accept="image/*">
          <input type="url" id="logoUrl" placeholder="æˆ–ç²˜è´´å›¾ç‰‡ URL">
        </div>
        <div class="small">ä¸Šä¼ å›¾ç‰‡ä¼šè¢«è½¬æ¢ä¸º data URL å¹¶ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œé€‚åˆå¿«é€Ÿéƒ¨ç½² demoï¼›é•¿æœŸå»ºè®®å¡«å…¥å¤–é“¾ URLï¼ˆè‡ªè¡Œæ‰˜ç®¡ï¼‰ã€‚</div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(15,12,20,0.04)">

      <div class="field">
        <label>å›¾æ ‡å›¾ç‰‡æ›¿æ¢ï¼ˆæ¯ä¸ªå›¾æ ‡åˆ†åˆ«ä¸Šä¼ æˆ–å¡« URLï¼‰</label>

        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px">
          <!-- æ¯ä¸ªå›¾æ ‡ä¸€è¡Œ file + url -->
          <div>
            <div style="font-weight:600;margin-bottom:6px">èŠå¤© (chat)</div>
            <input type="file" data-key="chat" class="iconFile" accept="image/*">
            <input type="url" data-key="chat" class="iconUrl" placeholder="æˆ–å›¾ç‰‡ URL" style="margin-top:6px">
          </div>

          <div>
            <div style="font-weight:600;margin-bottom:6px">æ—¥è®° (diary)</div>
            <input type="file" data-key="diary" class="iconFile" accept="image/*">
            <input type="url" data-key="diary" class="iconUrl" placeholder="æˆ–å›¾ç‰‡ URL" style="margin-top:6px">
          </div>

          <div>
            <div style="font-weight:600;margin-bottom:6px">è®ºå› (forum)</div>
            <input type="file" data-key="forum" class="iconFile" accept="image/*">
            <input type="url" data-key="forum" class="iconUrl" placeholder="æˆ–å›¾ç‰‡ URL" style="margin-top:6px">
          </div>

          <div>
            <div style="font-weight:600;margin-bottom:6px">API è®¾ç½® (api)</div>
            <input type="file" data-key="api" class="iconFile" accept="image/*">
            <input type="url" data-key="api" class="iconUrl" placeholder="æˆ–å›¾ç‰‡ URL" style="margin-top:6px">
          </div>

          <div>
            <div style="font-weight:600;margin-bottom:6px">ç¾åŒ– (theme)</div>
            <input type="file" data-key="theme" class="iconFile" accept="image/*">
            <input type="url" data-key="theme" class="iconUrl" placeholder="æˆ–å›¾ç‰‡ URL" style="margin-top:6px">
          </div>

          <div>
            <div style="font-weight:600;margin-bottom:6px">æ›´å¤š (more)</div>
            <input type="file" data-key="more" class="iconFile" accept="image/*">
            <input type="url" data-key="more" class="iconUrl" placeholder="æˆ–å›¾ç‰‡ URL" style="margin-top:6px">
          </div>
        </div>
      </div>

      <div class="modalActions">
        <button class="btnGhost" id="resetBtn">é‡ç½®ä¸ºé»˜è®¤</button>
        <button class="btnGhost" id="cancelBtn">å–æ¶ˆ</button>
        <button class="btnPrimary" id="saveBtn">ä¿å­˜å¹¶åº”ç”¨</button>
      </div>
    </div>
  </div>

  <script>
    // keys and default values
    const STORAGE_KEY = 'nie_home_settings_v1';

    const defaultState = {
      title: 'NIEaiphone',
      subtitle: 'æ¬¢è¿å›å®¶ Â· ç‚¹å‡»å›¾æ ‡æ‰“å¼€åº”ç”¨',
      logo: '', // default blank -> will show heart emoji fallback
      icons: {
        chat: '', // if empty will fallback to emoji-dataURI (we provide default URLs below)
        diary: '',
        forum: '',
        api: '',
        theme: '',
        more: ''
      }
    };

    // A few built-in default PNG/SVG URLs (data-URI or public images).
    // For demo we use small emoji-style SVG dataURIs (keeps file standalone).
    const builtin = {
      logo: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='32' width='100%' height='100%' fill='white'/><text x='50%' y='50%' font-size='120' text-anchor='middle' dominant-baseline='central'>ğŸ’œ</text></svg>`),
      chat: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='24' width='100%' height='100%' fill='transparent'/><text x='50%' y='52%' font-size='110' text-anchor='middle' dominant-baseline='central'>ğŸ’¬</text></svg>`),
      diary: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='24' width='100%' height='100%' fill='transparent'/><text x='50%' y='52%' font-size='100' text-anchor='middle' dominant-baseline='central'>ğŸ““</text></svg>`),
      forum: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='24' width='100%' height='100%' fill='transparent'/><text x='50%' y='52%' font-size='100' text-anchor='middle' dominant-baseline='central'>ğŸ§­</text></svg>`),
      api: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='24' width='100%' height='100%' fill='transparent'/><text x='50%' y='52%' font-size='96' text-anchor='middle' dominant-baseline='central'>ğŸ› ï¸</text></svg>`),
      theme: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='24' width='100%' height='100%' fill='transparent'/><text x='50%' y='52%' font-size='96' text-anchor='middle' dominant-baseline='central'>ğŸ¨</text></svg>`),
      more: 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect rx='24' width='100%' height='100%' fill='transparent'/><text x='50%' y='52%' font-size='110' text-anchor='middle' dominant-baseline='central'>âœ¨</text></svg>`)
    };

    // Utilities: load/save
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return structuredClone(defaultState);
        const parsed = JSON.parse(raw);
        // merge with default to tolerate older versions
        const state = structuredClone(defaultState);
        if(parsed.title) state.title = parsed.title;
        if(parsed.subtitle) state.subtitle = parsed.subtitle;
        if(parsed.logo) state.logo = parsed.logo;
        if(parsed.icons) state.icons = {...state.icons, ...parsed.icons};
        return state;
      }catch(e){
        console.error('loadState error', e);
        return structuredClone(defaultState);
      }
    }
    function saveState(state){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    // Apply state to UI
    function applyState(state){
      document.getElementById('pageTitle').textContent = state.title || defaultState.title;
      document.getElementById('pageSubtitle').textContent = state.subtitle || defaultState.subtitle;

      // logo
      const logoImg = document.getElementById('logoImg');
      if(state.logo){
        logoImg.src = state.logo;
        logoImg.alt = 'logo';
      } else {
        logoImg.src = builtin.logo;
        logoImg.alt = 'logo-default';
      }

      // icons
      const keys = Object.keys(defaultState.icons);
      keys.forEach(k=>{
        const el = document.getElementById('icon-' + k);
        if(state.icons && state.icons[k]){
          el.src = state.icons[k];
        } else {
          el.src = builtin[k] || '';
        }
      });
    }

    // Init on load
    let state = loadState();
    applyState(state);

    // Modal controls
    const modalWrap = document.getElementById('modalWrap');
    const openCustomize = document.getElementById('openCustomize');
    const cancelBtn = document.getElementById('cancelBtn');
    const saveBtn = document.getElementById('saveBtn');
    const resetBtn = document.getElementById('resetBtn');

    // form fields
    const inputTitle = document.getElementById('inputTitle');
    const inputSubtitle = document.getElementById('inputSubtitle');
    const logoFile = document.getElementById('logoFile');
    const logoUrl = document.getElementById('logoUrl');
    const iconFiles = document.querySelectorAll('.iconFile');
    const iconUrls = document.querySelectorAll('.iconUrl');

    function openModal(){
      // fill inputs from current state
      inputTitle.value = state.title || '';
      inputSubtitle.value = state.subtitle || '';
      logoUrl.value = ''; logoFile.value = '';
      // icon url fields blank by default
      iconFiles.forEach(f=>f.value='');
      iconUrls.forEach(i=>i.value='');
      modalWrap.style.display = 'flex';
      modalWrap.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modalWrap.style.display = 'none';
      modalWrap.setAttribute('aria-hidden','true');
    }

    openCustomize.addEventListener('click', openModal);
    cancelBtn.addEventListener('click', (e)=>{ e.preventDefault(); closeModal(); });
    modalWrap.addEventListener('click', (e)=>{ if(e.target === modalWrap) closeModal(); });

    // helper: read file input to dataURL (Promise)
    function fileToDataUrl(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = ()=> resolve(reader.result);
        reader.onerror = err => reject(err);
        reader.readAsDataURL(file);
      });
    }

    async function gatherAndSave(){
      // update title/subtitle
      state.title = inputTitle.value || defaultState.title;
      state.subtitle = inputSubtitle.value || defaultState.subtitle;

      // logo: prefer file over url if provided
      if(logoFile.files && logoFile.files[0]){
        try{
          const data = await fileToDataUrl(logoFile.files[0]);
          state.logo = data;
        }catch(e){ console.warn('logo file read err', e); }
      } else if(logoUrl.value && logoUrl.value.trim()){
        state.logo = logoUrl.value.trim();
      }
      // icons: for each file/url input
      const keys = Object.keys(defaultState.icons);
      for(const k of keys){
        const fileInput = document.querySelector('.iconFile[data-key="'+k+'"]');
        const urlInput = document.querySelector('.iconUrl[data-key="'+k+'"]');
        if(fileInput && fileInput.files && fileInput.files[0]){
          try{
            const data = await fileToDataUrl(fileInput.files[0]);
            state.icons[k] = data;
          }catch(e){ console.warn('icon file read err', e); }
        } else if(urlInput && urlInput.value && urlInput.value.trim()){
          state.icons[k] = urlInput.value.trim();
        }
        // if neither provided, keep existing state.icons[k] as is
      }

      saveState(state);
      applyState(state);
      closeModal();
    }

    saveBtn.addEventListener('click', (e)=>{ e.preventDefault(); gatherAndSave(); });

    // reset to defaults
    resetBtn.addEventListener('click', (e)=>{ e.preventDefault();
      if(confirm('ç¡®è®¤è¦æ¢å¤ä¸ºé»˜è®¤è®¾ç½®ï¼Ÿè¿™ä¼šæ¸…é™¤å·²ä¿å­˜çš„è‡ªå®šä¹‰å›¾ç‰‡ä¸æ–‡å­—ã€‚')) {
        state = structuredClone(defaultState);
        localStorage.removeItem(STORAGE_KEY);
        applyState(state);
        closeModal();
      }
    });

    // keyboard: enter to open icon (demo)
    document.querySelectorAll('.icon').forEach(el=>{
      el.addEventListener('click', ()=>{
        const key = el.getAttribute('data-key');
        // currently open demo modal for app; if you have pages, we can route
        // For now we show a quick alert or modal. For better UX open chat.html etc.
        // Let's navigate to dedicated pages if they exist (simple fallback).
        const mapping = {
          chat: 'chat.html',
          diary: 'diary.html',
          forum: 'forum.html',
          api: 'api.html',
          theme: 'theme.html',
          more: '#'
        };
        const href = mapping[key] || '#';
        if(href === '#') {
          alert('è¯¥åŠŸèƒ½å°†æ¥ä¼šå¼€æ”¾ï¼ˆæ›´å¤šåŠŸèƒ½å ä½ï¼‰ã€‚');
        } else {
          // try to navigate (if page exists)
          location.href = href;
        }
      });
    });

    // On first load, if logo blank set builtin
    if(!state.logo) state.logo = builtin.logo;
    // ensure icons fallback
    Object.keys(defaultState.icons).forEach(k=>{ if(!state.icons[k]) state.icons[k] = builtin[k]; });

    // apply initial state again (post-fallback)
    applyState(state);

  </script>
</body>
</html>
